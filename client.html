<html>
<head>
  <title>Simple client</title>

  
</head>
<body onload="init();">
  <form onsubmit="onSubmit(); return false;">
    <input type="text" id="input">
    <input type="submit" value="Send">
    <button onclick="onCloseClick(); return false;">close</button>
  </form>
  <canvas id="myCanvas" width="500" height="500"></canvas>

  
  <div id="log"></div>
</body>


<script type="text/javascript">

    var ws;
    
    function init() {

      // Connect to Web Socket
      ws = new WebSocket("ws://localhost:9001/");

      // Set event handlers.
      ws.onopen = function() {
        output("Connection established");
      };
      
      ws.onmessage = function(e) {
        // e.data contains received string.
        output("" + e.data);
      };
      
      ws.onclose = function() {
        output("onclose");
      };

      ws.onerror = function(e) {
        output("Error");
        console.log(e)
      };

    }
    
    function onSubmit() {
      var input = document.getElementById("input");
      // You can send message to the Web Socket using ws.send.
      ws.send(input.value);
      output("send: " + input.value);
      input.value = "";
      input.focus();
    }
    
    function onCloseClick() {
      ws.close();
    }
    
    function output(str) {
      var log = document.getElementById("log");
      var escaped = str.replace(/&/, "&amp;").replace(/</, "&lt;").
        replace(/>/, "&gt;").replace(/"/, "&quot;"); // "
      log.innerHTML = escaped + "<br>" + log.innerHTML;
    }
var selectedPiece=null;
//Credit for canvas image draw https://stackoverflow.com/questions/14012768/html5-canvas-background-image
var canvas = document.getElementById("myCanvas"),
ctx = canvas.getContext("2d");
canvasWidth=512
canvasHeight=512
canvas.width = canvasWidth;
canvas.height = canvasHeight;
	
	canvas.addEventListener('click', selectPiece);  // but it will work here

squareSize=canvasWidth/8
var black=false
for (var x = 0 ; x < 8 ; x++)  {
  for (var y = 0 ; y < 8 ; y++) {
    //console.log(x, y, (x*squareSize), (y*squareSize),  black, ctx.fillStyle);
    if (black) { ctx.fillStyle = "black"; }
    else { ctx.fillStyle = "white"; }
    ctx.fillRect(x*squareSize, y*squareSize, squareSize, squareSize);
    black = !black;
  }
  black = !black
}


var wPieces=[]
var bPieces=[]

var Piece=function(n, x, y, color, type)
{
this.name=n;
this.x=x;
this.y=y;
this.color=color
this.type=type
this.selected=false
}

var wKing = new Piece("White King", 64*4-32, 64/2, 'white',"K")
wPieces.push(wKing)
var wQueen=new Piece("White Queen", 64*5-32, 64/2, 'white',"Q")
wPieces.push(wQueen)
var bKing=new Piece("Black King", 64*4-32, canvasHeight-32, 'black', "K")
bPieces.push(bKing)
var bQueen=new Piece("Black Queen", 64*5-32, canvasHeight-32, 'black', "Q")
bPieces.push(bQueen)
redraw()

function redraw(){
for (i=0; i<wPieces.length; i++)
{
drawCircle(wPieces[i].x, wPieces[i].y, 30, 'white')
ctx.font = "30px Comic Sans MS";
ctx.fillStyle = "black";
ctx.textAlign = "center";
ctx.fillText(wPieces[i].type, wPieces[i].x, wPieces[i].y);


}//end of loop through white pieces
for (i=0; i<bPieces.length; i++){
drawCircle(bPieces[i].x, bPieces[i].y, 30, 'black')

ctx.font = "30px Comic Sans MS";
ctx.fillStyle = "white";
ctx.textAlign = "center";
ctx.fillText(bPieces[i].type, bPieces[i].x, bPieces[i].y);

}//end of loop through black pieces

//draw selection indicator around piece selected
if (selectedPiece != null){
ctx.fillStyle="yellow"
	ctx.globalAlpha = 0.5;
	ctx.fillRect(selectedPiece.x-squareSize/2, selectedPiece.y-squareSize/2, squareSize, squareSize); 
	ctx.globalAlpha = 1.0;
}// end of if (selectedPiece !=null ){...
	}//end of if selectedPiece not null
//}//end of redraw

function drawCircle(x,y, radius,color)
{


ctx.beginPath();
ctx.arc(x, y,radius,0,2*Math.PI);
ctx.fillStyle=color;
ctx.fill();


}//end of drawCircle method


function selectPiece()
{
	found=false
	mx = event.offsetX;
	my = event.offsetY;   //offsetX, offsetY, may not work in older browsers, especially Firefox
	console.log("mouse pos: "+mx+", "+my)
	
	for (i=0; i<wPieces.length; i++)
		{
		p=wPieces[i]
		if (mx < p.x+15 && mx > p.x-15 && my > p.y-15 && my < p.y+15)
		{
			if (selectedPiece != null){
			selectedPiece.selected=false
			}
			p.selected=true
			found=true
			selectedPiece=p
			console.log(selectedPiece.name+" selected")
			break;

		}//end of if whithin click range	
	}//end of loop through white pieces
	if (found == false)
	{
		for (i=0; i<bPieces.length; i++)
		{
			p=bPieces[i]
			if (mx < p.x+15 && mx > p.x-15 && my > p.y-15 && my < p.y+15)
			{
				p.selected=true
				selectedPiece=p
				found=true
				selectedPiece=p
				console.log(p.name+" selected")
				break;

			}//end of if whithin click range
		}//end of loop through black  pieces
	}//end of if not found

redraw()

}	//end of click on canvas function

  </script>

</html>